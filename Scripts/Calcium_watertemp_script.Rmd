---
title: "Merged LakeWaterTemp and Calcium data"
output: html_notebook
---


Load Lake water temp and calcium data sets and site info data into Environment
```{r echo=T, results='hide'}
CRB_Ca <- readRDS("D:/Sepulveda_USGS/BOR_mussel_waterquality/DreissenidWaterQuality/Data/processed/CRB_Ca.rds")
CRB_Laketemp_reduced <- readRDS("D:/Sepulveda_USGS/BOR_mussel_waterquality/DreissenidWaterQuality/Data/processed/CRB_Laketemp_reduced.rds")
```


Inner_join, which only filters data to just data with same MonitoringLocation Name with samples collected on same date
```{r message=FALSE, warning=FALSE}

Lake_temp_water = inner_join(CRB_Ca, CRB_Laketemp_reduced, by = c("MonitoringLocationIdentifier", "start"="Waterstart")) %>% 
  mutate(Ca_max = max, Ca_mean = mean)


```


Now, recode calcium data based on water temp.  Where high-quality data are those within 12 - 28 C, low quality are all other data. 

```{r}
Lake_temp_water_quality = Lake_temp_water %>% 
  mutate(TempQuality = if_else(Watermean >= 12 & Watermean<=28, "HighQuality", "LowQuality"))

Lake_temp_water_lowQ = Lake_temp_water_quality %>% 
  filter(TempQuality == "LowQuality")

Lake_temp_water_highQ = Lake_temp_water_quality %>% 
  filter(TempQuality == "HighQuality")
  
```


Map it!
```{r}

col_types <- c("darkblue","pink", "orange","red")  
risk.bins = c(0, 11.99, 19.99, 27.99, 20000)
risk.pal = colorBin(col_types, bins = risk.bins, na.color = "#aaff56")
rad <-3*seq(1,4,length.out = 16)
#Lake_temp_water_quality$sizes <- rad[as.numeric(cut(Lake_temp_water_quality$count, breaks=16))]


CaMap_LowQuality = leaflet(data=Lake_temp_water_lowQ) %>% 
      #addTiles() %>% for simple openstreet basemap
      addProviderTiles(providers$Esri.NatGeoWorldMap) %>%  #This is cool... https://rstudio.github.io/leaflet/basemaps.html
      addCircleMarkers(~dec_lon_va.x,~dec_lat_va.x,
                       fillColor = ~risk.pal(Ca_max),
                       radius = 2,  # to make size a function of count replace with ~sizes
                       fillOpacity = 0.8, opacity = 0.8,stroke=FALSE,
                       popup=~station_nm.y) %>%
      addLegend(position = 'bottomleft',
                pal=risk.pal,
                values=~Ca_max,
                opacity = 0.8,
                labFormat = labelFormat(digits = 1), 
                title = 'Max Ca Value, low quality') %>% 
  mapview::addMouseCoordinates(style = "basic") %>% 
  setView(lng = -118.3,
          lat = 45.6,
          zoom = 5.45)


CaMap_HighQuality = leaflet(data=Lake_temp_water_highQ) %>% 
      #addTiles() %>% for simple openstreet basemap
      addProviderTiles(providers$Esri.NatGeoWorldMap) %>%  #This is cool... https://rstudio.github.io/leaflet/basemaps.html
      addCircleMarkers(~dec_lon_va.x,~dec_lat_va.x,
                       fillColor = ~risk.pal(Ca_max),
                       radius = 2,  # to make size a function of count replace with ~sizes
                       fillOpacity = 0.8, opacity = 0.8,stroke=FALSE,
                       popup=~station_nm.y) %>%
      addLegend(position = 'bottomleft',
                pal=risk.pal,
                values=~Ca_max,
                opacity = 0.8,
                labFormat = labelFormat(digits = 1), 
                title = 'Max Ca Value, high quality') %>% 
  mapview::addMouseCoordinates(style = "basic") %>% 
  setView(lng = -118.3,
          lat = 45.6,
          zoom = 5.45)

latticeview(CaMap_LowQuality, CaMap_HighQuality)

```







Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
